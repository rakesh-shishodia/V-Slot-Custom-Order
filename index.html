<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom Cut and Machined Aluminium Extrusion Orders in India</title>
  <meta name="description" content="Order custom-cut V-Slot, C-Beam & T-Slot aluminium extrusions with M5/M6/M8 tapping and counterbores. Free shipping. Next-day dispatch from India.">
  <link rel="stylesheet" href="styles.css">  
  <!-- Include jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Ecwid data loader (our new module) -->
  <script src="ecwid-data.js"></script>
  <!-- re-direct cart clicks to full page -->
  <!-- Include Ecwid script for Cart API (store id: 2442119) -->
  <script src="https://app.ecwid.com/script.js?2442119&data_platform=code&data_date=2025-03-02" charset="utf-8"></script>
  <!-- Include review script to show product review summary-->
  <script defer src="https://app.helpfulcrowd.com/f/koS4zR/widgets/product_summary.js"></script>
  <!-- SimpleLightbox CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simplelightbox@2.14.1/dist/simple-lightbox.min.css" />
  <!-- SimpleLightbox JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/simplelightbox@2.14.1/dist/simple-lightbox.jquery.min.js"></script>
  
</head>
<body>

<!-- Tool Header -->
<header class="tool-header">
  <div class="header-left">3DPrintronics</div>
  <h1 class="header-title">
    Custom Cut and Machined Aluminium Extrusion Orders in India
  </h1>
  <div class="header-right">
      <div class="ec-cart-widget"></div>
  </div>
</header>

<!-- Filter Controls and Product Boxes Side-by-Side -->
<div class="filter-product-container">
  <!-- Filter Controls -->
  <div class="filter-panel">
    <h2 class="filter-title">Filter</h2>
    <div id="filterControls">
      <div class="filter-group" id="typeFilters"><strong>Type:</strong></div>
      <div class="filter-group" id="seriesFilters"><strong>Series:</strong></div>
      <div class="filter-group" id="colorFilters"><strong>Colour:</strong></div>
      <button type="button" id="clearFiltersBtn">Clear Filters</button>
    </div> <!-- /#filterControls -->
  </div> <!-- /.filter-panel -->
  <!-- Extrusion Selector -->
  <div class="selector-panel">
    <h2 class="selector-title">Select Extrusion and Enter Details in Table Below</h2>
  <div class="extrusion-selector-wrapper">
    <div class="extrusion-selector" id="extrusionSelector">
      <!-- Extrusion boxes will be dynamically populated from extrusions.json -->
    </div>
  </div>
  </div>
</div> <!-- /.filter-product-container -->
<div class="flex-container">
  <div class="details-panel panel">
    <div class="image-grid">
      <div class="image-cell">
        <a href="" class="detail-thumb-link">
          <img src="" alt="Thumbnail" class="detail-thumb" />
        </a>
        <span class="zoom-icon">üîç</span>
      </div>
      <div class="image-cell">
        <!-- Top-right image placeholder; will be dynamically set -->
        <a href="">
          <img src="" alt="Secondary image" />
        </a>
        <span class="zoom-icon">üîç</span>
      </div>
      <div class="image-cell">
        <a href="" class="detail-image-link">
          <img src="" alt="" />
        </a>
        <span class="zoom-icon">üîç</span>
      </div>
      <div class="image-cell">
        <a href="" class="detail-image-link">
          <img src="" alt="" />
        </a>
        <span class="zoom-icon">üîç</span>
      </div>
    </div>
    <div class="video-grid" id="videoGrid">
      <!-- Video iframes will be inserted here -->
    </div>
    <div class="description-container">
      <!-- Product description (supports HTML formatting) -->
    </div>
  </div>
  <div class="order-panel">

<!-- Custom Ordering Table -->
<div id="formError" class="error-banner" style="display:none;"></div>
<form id="extrusionForm">
  <table id="orderTable">
    <thead>
      <tr>
        <th>
          Enter Cut Length in mm<br>
          (min 100mm, max 3000mm)
        </th>
        <th>
          M5 Tap
          <span class="info-icon" data-info="For V Slot - M5x15mm, For 3030 T Slot - M8X15mm, For others please check drawing">
            <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
              <circle cx="8" cy="8" r="7" fill="#006064"/>
              <text x="8" y="12" font-size="10" text-anchor="middle" fill="#fff">i</text>
            </svg>
          </span>
        </th>
        <th>
          Counter Bore
          <span class="info-icon" data-info="For V Slot: ID 5mm, OD 10mm; For 3030: ID 8mm, OD 15mm; For others, check drawing">
            <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
              <circle cx="8" cy="8" r="7" fill="#006064"/>
              <text x="8" y="12" font-size="10" text-anchor="middle" fill="#fff">i</text>
            </svg>
          </span>
        </th>
        <th>No. of Pcs</th>
        <th>Row Total <br>
          Length</th>
        <th>Reset or <br>
          Delete Row</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- 6 rows will be inserted dynamically -->
    </tbody>
  </table>
  
  <button type="button" id="addRowBtn">Add More Rows</button>
  <button type="button" id="resetAllBtn">Reset All</button>
  
  <!-- Aggregate Totals Table -->
  <table class="totals-table">
    <thead>
      <tr>
        <th>Total Length <br> Ordered</th>
        <th>Rounded Off Length <br> (to nearest 500mm)</th>
        <th>Cost of Rounded Off Length</th>
        <!-- <th>Discount (2.5-4m:5%, 4.5-8m:10%, Above 8.5m:15%)</th> -->
        <th>Total <br>M5 Taps</th>
        <th>Cost M5 Taps <br>(‚Çπ30/hole)</th>
        <th>Total <br>CB Holes</th>
        <th>Cost CB Holes<br>(‚Çπ70/hole)</th>
        <th>Subtotal</th>
        <th>GST<br>@18%</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="totalOrdered">0</td>
        <td id="roundedLength">0</td>
        <td id="costExtrusions">0</td>
        <!-- <td id="discount">0</td> -->
        <td id="totalM5Count">0</td>
        <td id="totalM5Cost">0</td>
        <td id="totalCBCount">0</td>
        <td id="totalCBCost">0</td>
        <td id="subtotal">0</td>
        <td id="GST">0</td>
        <td id="Total">0</td>
      </tr>
    </tbody>
  </table>
  
  <button type="button" id="addToCartBtn">Add to Cart</button>
</form>

    <!-- Material & Waste Policy Notice -->
    <div class="waste-policy" style="margin: 15px 0; font-size: 14px; color: #333;">
      <p>
        <strong>Billing is rounded up to the nearest 500 mm; any off-cut over 100 mm is shipped to you.</strong><br>
        <strong>Example</strong> ‚Äì You order <strong>2 pcs of 1000 mm</strong> and <strong>1 pc of 1200 mm</strong> (total 3200 mm), so we bill for <strong>3500 mm</strong>. You‚Äôll receive your <strong>2 pcs of 1000 mm</strong>, <strong>1 pc of 1200 mm</strong> plus a <strong>300 mm off-cut</strong>.<br>
        <a href="#" id="readMoreLink" style="text-decoration: underline; cursor: pointer;">[Read More]</a>
      </p>
      <div id="wasteDetails" style="display:none; margin-top:10px; padding-left:10px; border-left: 3px solid #ff9800;">
        <strong>Material &amp; Waste Policy</strong><br><br>
        We cut orders in 500 mm increments to reduce material wastage, keep our prices low and our operations efficient, and <strong>those savings go straight into your final per-metre rate</strong>.<br><br>
        <strong>How it works:</strong><br>
        1. Rounding: Every order is rounded up to the next 500 mm increment and accordingly billed for.<br>
        2. Clean-offs: Rather than discard leftovers, we ship you any piece longer than 100 mm.<br><br>
        <strong>Real-world example:</strong><br>
        ‚Ä¢ You specify: 2 pcs of 1000 mm and 1 pc of 1200 mm (total 3200 mm).<br>
        ‚Ä¢ We round up and bill 3500 mm at your per-metre rate.<br>
        ‚Ä¢ You receive 2 pcs of 1000 mm and 1 pc of 1200 mm plus a 300 mm off-cut which you can use for jigs, fixtures, or future tweaks.<br><br>
        This policy keeps our material costs predictable and our prices competitive‚Äîwhile ensuring you never Total for wasted material.
      </div>
    </div>
  </div> <!-- .order-panel -->
</div> <!-- .flex-container -->

<script>

  let config = {};
  let pendingProductOptions = null;
  // Global variables
  let selectedExtrusion = null;  // Currently selected extrusion object
  const additionalCosts = { m5Tapping: 30, counterBore: 70 };

  // Load configuration from Ecwid instead of extrusions.json
EcwidData.fetchAll()
  .then(data => {
    config.extrusions      = data;
    config.standardLengths = EcwidData.standardLengths;
    // Initialize filter module
    VSlot.filters.init(config.extrusions);
    // Populate selector and update totals
    populateExtrusionBoxes(config.extrusions);
    // Auto-select first extrusion on page load
    const $firstBox = $('#extrusionSelector .extrusion-box').first();
    if ($firstBox.length) {
      $firstBox.addClass('selected').trigger('click');
    }
    updateTotals();
  })
  .catch(err => console.error('EcwidData.fetchAll() failed:', err));
  // Dynamically build the extrusion selector buttons
  function populateExtrusionBoxes(items) {
    const list = items || config.extrusions;
    const container = $('#extrusionSelector');
    // Clear existing selector boxes
    container.empty();
    // Re-add selector title
    list.forEach(function(item) {
      const pricePerMeter = (item.baseCostPerMm * 1000).toFixed(0);
      const box = $(`
        <div class="extrusion-box" data-id="${item.id}">
          <div class="extrusion-name">${item.name}</div>
          <div class="price-per-meter">‚Çπ${pricePerMeter}/m</div>
           <div class="stock-pill">${ item.inStock ? 'In Stock' : 'Out of Stock' }</div>
        </div>
      `);
      if (!item.inStock) {
      box.find('.stock-pill').addClass('out-of-stock');
      }
      box.on('click', function() {
        $('.extrusion-box').removeClass('selected');
        $(this).addClass('selected');
        selectedExtrusion = item;
        // Disable Add to Cart if the selected extrusion is out of stock
        if (!item.inStock) {
          $('#addToCartBtn').prop('disabled', true);
        }
        // Populate all four detail images from Ecwid data
        const imgs = item.images; 
        const $cells = $('.details-panel .image-grid .image-cell');
        $cells.each(function(idx) {
          const url = imgs[idx] || '';
          const $link = $(this).find('a');
          const $img  = $link.find('img');
          if (url) {
            $link.attr('href', url);
            $img.attr('src', url);
          } else {
            $link.removeAttr('href');
            $img.attr('src', '');
          }
        });
        // Reinitialize SimpleLightbox to include updated anchors
        if (detailLightbox && typeof detailLightbox.destroy === 'function') {
          detailLightbox.destroy();
        }
        detailLightbox = $('.details-panel .image-grid a').simpleLightbox({
          captions: false,
          nav: true,
          close: true,
          docClose: true,
          enableKeyboard: true,
          showCounter: false
        });
        // Insert description HTML from Ecwid data
        $('.description-container').html(item.descriptionHtml);
        // Insert video iframes (up to 4), stacked vertically
        const $videoGrid = $('#videoGrid').empty();
        const videoUrls = (item.videos || []).slice(0, 4);
        videoUrls.forEach(url => {
        const embedUrl = url.replace("watch?v=", "embed/");
        const $iframe = $(`
        <iframe width="100%" height="315" 
            src="${embedUrl}" 
            title="YouTube video player" 
            frameborder="0" allowfullscreen loading="lazy">
        </iframe>
  `);
  $videoGrid.append($iframe);
});
        // Recalculate aggregate totals when extrusion selection changes.
        updateTotals();
      });
      container.append(box);
    });
  }
    
  // Calculate and display a single row‚Äôs total length
  function updateRow($row) {
    const cutLength = parseFloat($row.find('.cut-length').val()) || 0;
    const numPcs = parseFloat($row.find('.num-pcs').val()) || 0;
    const rowTotal = cutLength * numPcs;
    $row.find('.row-total-length').text(rowTotal.toFixed(0));
  }
  
  // Aggregate all rows, perform rounding and cost calculations, and update the totals table
  function updateTotals() {
    let totalOrdered = 0;
    let totalM5Count = 0;
    let totalCBCount = 0;
    $('#tableBody tr').each(function() {
      const rowTotal = parseFloat($(this).find('.row-total-length').text()) || 0;
      totalOrdered += rowTotal;
  
      const tapChoice = $(this).find('.tap-side').val();
      const pcsValue = parseFloat($(this).find('.num-pcs').val()) || 0;
      let sides = 0;
      if (tapChoice === 'one') sides = 1;
      else if (tapChoice === 'both') sides = 2;
      const holesPerSide = selectedExtrusion.holesPerSide || 0;
      totalM5Count += sides * holesPerSide * pcsValue;
  
      const cbValue = parseFloat($(this).find('.cb-holes').val()) || 0;
      totalCBCount += cbValue * pcsValue;
    });
    $('#totalOrdered').text(totalOrdered.toFixed(0));
  
    let roundedLength = 0;
    if (totalOrdered > 0 && selectedExtrusion) {
      roundedLength = config.standardLengths.find(len => len >= totalOrdered)
                      || config.standardLengths[config.standardLengths.length - 1];
    }
    console.log("Total Ordered Length:", totalOrdered);
    console.log("Rounded Length Before Selection:", roundedLength);
    console.log("Available Standard Lengths:", config.standardLengths);
    $('#roundedLength').text(roundedLength.toFixed(0));
  
    let costExtrusions = 0;
    if (selectedExtrusion && selectedExtrusion.baseCostPerMm) {
      costExtrusions = roundedLength * selectedExtrusion.baseCostPerMm;
      console.log("Base Cost Per mm:", selectedExtrusion.baseCostPerMm);
      console.log("Calculated Cost:", costExtrusions);
    } else {
      console.log("Error: selectedExtrusion not set or baseCostPerMm missing");
    }
    $('#costExtrusions').text(costExtrusions.toFixed(2));
  
    $('#totalM5Count').text(totalM5Count.toFixed(0));
    $('#totalCBCount').text(totalCBCount.toFixed(0));
  
    const totalM5Cost = totalM5Count * additionalCosts.m5Tapping;
    const totalCBCost = totalCBCount * additionalCosts.counterBore;
    $('#totalM5Cost').text(totalM5Cost.toFixed(2));
    $('#totalCBCost').text(totalCBCost.toFixed(2));
  
    const subtotal = costExtrusions + totalM5Cost + totalCBCost;
    $('#subtotal').text(subtotal.toFixed(2));

    const GST = subtotal * .18;
    $('#GST').text(GST.toFixed(2));

    const Total = subtotal + GST;
    $('#Total').text(Total.toFixed(2));

  
    // Disable Add to Cart if aggregate rounded length is 0.
    if (roundedLength === 0) {
      $('#addToCartBtn').prop('disabled', true);
    } else {
      $('#addToCartBtn').prop('disabled', false);
    }

    // Disable Add to Cart if item is out of stock.
    if (!selectedExtrusion.inStock) {
    $('#addToCartBtn').prop('disabled', true);
    }
  }
  
  // (Removed: Event listener moved to end of script)
  
  // Handle "Add to Cart" button clicks: build options and call Ecwid API
  $('#addToCartBtn').on('click', function() {
    console.log('Add to Cart clicked, selectedExtrusion:', selectedExtrusion);
    // Clear previous errors
    $('#formError').hide();
    $('.cut-length').removeClass('error');
    
    // Validate cut-length inputs
    let invalidCut = false;
    $('.cut-length').each(function() {
      const raw = $(this).val().trim();
      if (raw === '') {
        return; // skip empty fields
      }
      const v = parseFloat(raw);
      if (isNaN(v) || v < 100 || v > 3000) {
        invalidCut = true;
        $(this).addClass('error');
      }
    });
    if (invalidCut) {
      $('#formError')
        .text("Please correct the highlighted cut lengths (100‚Äì3000 mm).")
        .show();
      return;
    }
    if (!selectedExtrusion) {
      alert("Please select an extrusion type.");
      return;
    }
  
    // Build detailed order string from table rows in the format "cutLength-numPcs pc-M5Tap{m5}-CBHole{cb}"
    let orderDetails = [];
    $('#tableBody tr').each(function() {
      const cutLength = $(this).find('.cut-length').val();
      const numPcs = $(this).find('.num-pcs').val();
      const tapChoice = $(this).find('.tap-side').val();
      const holesPerSide = selectedExtrusion.holesPerSide || 0;
      const sides = tapChoice === 'both' ? 2 : (tapChoice === 'one' ? 1 : 0);
      const m5 = sides * holesPerSide;
      const cb = $(this).find('.cb-holes').val();
      if (cutLength && numPcs) {
        orderDetails.push(`${cutLength}-${numPcs}pc-M5Tap${m5 || 0}-CBHole${cb || 0}`);
      }
    });
    const detailsString = orderDetails.join('; ');
  
    // Retrieve aggregated totals from the totals table.
    const totalM5Count = parseInt($('#totalM5Count').text(), 10) || 0;
    const totalCBCount = parseInt($('#totalCBCount').text(), 10) || 0;
    const roundedLengthValue = parseInt($('#roundedLength').text(), 10) || 0;
  
    // Build the same semicolon-separated Cut Details for Ecwid
    const previewLines = orderDetails.map(detail => {
      const [length, pcsPart, tapPart, cbPart] = detail.split('-');
      const count = parseInt(pcsPart, 10) || 0;
      const pcsLabel = count === 1 ? '1 pc' : `${count} pcs`;
      let tapsLabel = tapPart === 'M5Tap0'
        ? 'No Tapping'
        : (tapPart === 'M5Tap1'
            ? 'One Side M5 Tapped'
            : 'Both Sides M5 Tapped');
      const cbCount = parseInt(cbPart.replace('CBHole', ''), 10) || 0;
      const cbsLabel = cbCount === 0 ? 'No CB Holes' : `${cbCount} CB Holes`;
      return `${pcsLabel} of ${length} mm ‚Äì ${tapsLabel}, ${cbsLabel} in each`;
    });
    // Assign to pendingProductOptions for Ecwid
    pendingProductOptions = {
      "Length": roundedLengthValue.toString(),
      "M5 Tap Holes": totalM5Count.toString(),
      "Counter Bore Holes": totalCBCount.toString(),
      "Cut Details": previewLines.join('; ')
    };

    // Build human-readable preview lines in desired format
    $('#previewTitle').text(`Your Order for ${selectedExtrusion.name}`);
    $('#previewList').empty();
    let totalPcs = 0;
    orderDetails.forEach(detail => {
      const [length, pcsPart, tapPart, cbPart] = detail.split('-');
      const count = parseInt(pcsPart, 10) || 0;
      const pcsLabel = count === 1 ? '1 pc' : `${count} pcs`;
      // Determine tap description
      let tapsLabel;
      if (tapPart === 'M5Tap0') tapsLabel = 'No Tapping';
      else if (tapPart === 'M5Tap1') tapsLabel = 'One Side M5 Tapped';
      else tapsLabel = 'Both Sides M5 Tapped';
      // Determine CB description
      const cbCount = parseInt(cbPart.replace('CBHole', ''), 10) || 0;
      const cbsLabel = cbCount === 0
        ? 'No CB Holes'
        : `${cbCount} CB Holes`;
      // Append as list item
      $('#previewList').append(
        `<li>${pcsLabel} of ${length} mm¬†‚Äì ${tapsLabel}, ${cbsLabel} in each</li>`
      );
      totalPcs += count;
    });
    $('#previewTotal').text(`Total Pcs ‚Äì ${totalPcs}`);
// Show preview modal and halt actual add-to-cart
$('#orderPreviewModal').show();
return;
  
    // Optionally, log the product options before adding to cart.
    console.log('Adding product with options:', pendingProductOptions);
    
    Ecwid.Cart.addProduct({
      id: selectedExtrusion.id,
      quantity: 1,
      options: pendingProductOptions
    },
    function(order) {
      console.log('Add to Cart success callback, order:', order);
      // Populate and show success modal with order details
      document.getElementById('modalDetails').textContent = detailsString;
      document.getElementById('successModal').style.display = 'block';
    },
    function(error) {
      console.error('Add to Cart error callback, error:', error);
    });
  });
</script>
</script>

<!-- Order Preview Modal -->
<div id="orderPreviewModal" class="modal">
  <div class="modal-content">
    <span class="close" id="previewClose" aria-label="Close preview">&times;</span>
    <h2 id="previewTitle">Your Order for </h2>
    <ul id="previewList" style="text-align:left; margin:10px 0;"></ul>
    <p id="previewTotal" style="font-weight:bold;"></p>
    <button type="button" id="amendOrderBtn">Amend Order</button>
    <button type="button" id="proceedOrderBtn">Proceed to Add to Cart</button>
  </div>
</div>
<!-- Success Modal -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <span id="modalClose" class="close">&times;</span>
    <h2>Successfully Added to Cart</h2>
    <p id="modalDetails"></p>
  </div>
</div>

<!-- Info-icon modal (singleton!) -->
<div id="infoModal" class="modal">
  <div class="modal-content">
    <span id="infoModalClose" class="close" aria-label="Close info">&times;</span>
    <div id="infoModalText"></div>
  </div>
</div>

<script>
  // Modal behavior: close on click outside or on close button
  // Modal control
  const successModal = document.getElementById('successModal');
  const previewModal = document.getElementById('orderPreviewModal');
  const modalClose = document.getElementById('modalClose');
  modalClose.onclick = () => { successModal.style.display = 'none'; };
  window.onclick = (event) => {
    if (event.target === successModal) {
      successModal.style.display = 'none';
    }
    if (event.target === previewModal) {
      previewModal.style.display = 'none';
    }
  };
  // Preview modal controls
  $('#previewClose').on('click', () => { $('#orderPreviewModal').hide(); });
  $('#amendOrderBtn').on('click', () => { $('#orderPreviewModal').hide(); });
  $('#proceedOrderBtn').on('click', () => {
    console.log('Proceed clicked')
    $('#orderPreviewModal').hide();
    Ecwid.Cart.addProduct({
      id: selectedExtrusion.id,
      quantity: 1,
      options: pendingProductOptions
    }, function(success) {
      console.log('üõí addProduct callback, success:', success);
      if (success) {
        VSlot.table.init();
        updateTotals();
        // Show cut details in the success modal
        const detailsText = pendingProductOptions && pendingProductOptions["Cut Details"]
                          ? pendingProductOptions["Cut Details"]
                          : 'Added to cart successfully.';
        $('#modalDetails').text(detailsText);
        pendingProductOptions = null;
        $('#successModal').show();
      } else {
        console.error('Add to cart failed.');
      }
    });
  });
</script>
  <!-- Code for Inline Info Icon -->
<script>
  (function() {
    const modal = document.getElementById('infoModal');
    const text  = document.getElementById('infoModalText');
    const close = document.getElementById('infoModalClose');

    document.body.addEventListener('click', (e) => {
      const icon = e.target.closest('.info-icon');
      if (!icon) return;
      const msg = icon.dataset.info;
      if (!msg) return;
      text.textContent = msg;
      modal.style.display = 'flex';
    });

    close.addEventListener('click', () => modal.style.display = 'none');
    modal.addEventListener('click', e => {
      if (e.target === modal) modal.style.display = 'none';
    });
  })();
  </script>
</body>
<script>
(function(VSlot, $) {
  // Centralized settings for table module
  const settings = {
    minLen: 100,
    maxLen: 3000,
    initRows: 4
  };
  // Cache jQuery selectors for table, add row, and reset all buttons
  const $tableBody   = $('#tableBody');
  const $addRowBtn   = $('#addRowBtn');
  const $resetAllBtn = $('#resetAllBtn');
  // Utility: debounce to limit frequent calls
  function debounce(fn, delay) {
    let timer;
    return function() {
      const context = this, args = arguments;
      clearTimeout(timer);
      timer = setTimeout(() => fn.apply(context, args), delay);
    };
  }
  // Debounced version of updateTotals to prevent layout thrashing
  const debouncedUpdateTotals = debounce(updateTotals, 100);
  // Table module for cut orders
  VSlot.table = {
    createRow: function() {
      return `
        <tr>
          <td><input type="number" class="cut-length" placeholder="Precisely Cut" min="${settings.minLen}" max="${settings.maxLen}" required /></td>
          <td><select class="tap-side" required>
            <option value="none">No Tapping</option>
            <option value="one">One Side</option>
            <option value="both">Both Sides</option>
          </select></td>
          <td class="cb-holes-cell">
            <input type="number" class="cb-holes" value="0" min="0" max="20" required />
            <span class="cb-holes-suffix">holes</span>
          </td>
          <td><input type="number" class="num-pcs" placeholder="No. of Pcs" min="1" required /></td>
          <td class="row-total-length">0</td>
          <td>
            <button type="button" class="reset-row-btn">Reset</button>
            <button type="button" class="delete-row-btn">Del</button>
          </td>
        </tr>
      `;
    },
    attachRowListeners: function($row) {
      // Prevent non-numeric input in cut-length and pcs fields, and remove error when pcs ‚â•1
      $row.find('.cut-length, .num-pcs').on('input', function() {
        this.value = this.value.replace(/\D/g, '');
        if ($(this).hasClass('num-pcs')) {
          const v = parseInt(this.value, 10) || 0;
          if (v >= 1) {
            $(this).removeClass('error');
            // Hide the form error banner if no errors remain
            if ($('.cut-length.error, .num-pcs.error').length === 0) {
              $('#formError').hide();
            }
          }
        }
      });
      // Require at least 1 piece when a cut-length is specified
      $row.find('.num-pcs').on('blur', function() {
        const pcsVal = parseInt($(this).val(), 10) || 0;
        const cutVal = parseFloat($row.find('.cut-length').val()) || 0;
        if (cutVal > 0 && pcsVal < 1) {
          $(this).addClass('error');
          $('#formError')
            .text("Please enter at least 1 piece for each specified cut length.")
            .show();
        }
      });
      // Prevent non-numeric input in counter bore holes, reverting to 0 if emptied
      $row.find('.cb-holes').on('input', function() {
        const cleaned = this.value.replace(/\D/g, '');
        this.value = cleaned === '' ? '0' : cleaned;
      });
      $row.find('input, select.tap-side').on('input change', function() {
        // If this is a cut-length field, remove error styling when valid
        if ($(this).hasClass('cut-length')) {
          const raw = $(this).val().trim();
          const v = parseFloat(raw);
          if (!isNaN(v) && v >= settings.minLen && v <= settings.maxLen) {
            $(this).removeClass('error');
          }
          // Hide the form error banner if no more invalid cut-length fields
          if ($('.cut-length.error').length === 0) {
            $('#formError').hide();
          }
        }
        updateRow($row);
        debouncedUpdateTotals();
      });
      $row.find('.reset-row-btn').on('click', function() {
        $row.find('input').val('');
        updateRow($row);
        updateTotals();
      });
      $row.find('.delete-row-btn').on('click', function() {
        $row.remove();
        updateTotals();
      });
    },
    init: function() {
      // Delegate all row-specific events to table container
      $tableBody
        .on('input change', '.cut-length, .tap-side, .num-pcs', function() {
          // Numeric-only enforcement for cut-length and pcs
          if ($(this).is('.cut-length, .num-pcs')) {
            this.value = this.value.replace(/\D/g, '');
          }
          const $row = $(this).closest('tr');
          // If cut-length, validate range and clear error
          if ($(this).hasClass('cut-length')) {
            const v = parseFloat($(this).val()) || 0;
            if (v >= settings.minLen && v <= settings.maxLen) {
              $(this).removeClass('error');
              if ($('.cut-length.error').length === 0) {
                $('#formError').hide();
              }
            }
          }
          // If this is the pcs field, remove error styling when valid
          if ($(this).hasClass('num-pcs')) {
            const v = parseInt($(this).val(), 10) || 0;
            if (v >= 1) {
              $(this).removeClass('error');
              if ($('.cut-length.error, .num-pcs.error').length === 0) {
                $('#formError').hide();
              }
            }
          }
          updateRow($row);
          debouncedUpdateTotals();
        })
        .on('input', '.cb-holes', function() {
          const cleaned = this.value.replace(/\D/g, '');
          this.value = cleaned === '' ? '0' : cleaned;
        })
        .on('blur', '.num-pcs', function() {
          const $pcs = $(this);
          const cutVal = parseFloat($pcs.closest('tr').find('.cut-length').val()) || 0;
          const pcsVal = parseInt($pcs.val(), 10) || 0;
          if (cutVal > 0 && pcsVal < 1) {
            $pcs.addClass('error');
            $('#formError')
              .text("Please enter at least 1 piece for each specified cut length.")
              .show();
          }
        })
        .on('click', '.reset-row-btn', function() {
          const $row = $(this).closest('tr');
          $row.find('input').val('');
          updateRow($row);
          updateTotals();
        })
        .on('click', '.delete-row-btn', function() {
          $(this).closest('tr').remove();
          updateTotals();
        });

      // Add More Rows button handler
      $addRowBtn.on('click', () => {
        const $new = $(this.createRow());
        $tableBody.append($new);
        debouncedUpdateTotals();
      });

      // Reset All button handler
      $resetAllBtn.on('click', () => {
        const resetHtml = Array(settings.initRows).fill(this.createRow()).join('');
        $tableBody.html(resetHtml);
        debouncedUpdateTotals();
      });
      // Render initial rows according to settings
      const rowsHtml = Array(settings.initRows).fill(this.createRow()).join('');
      $tableBody.html(rowsHtml);
    }
  };
  window.VSlot = VSlot;
})(window.VSlot = window.VSlot || {}, jQuery);

</script>
<script>
$(function() {
  // Initialize SimpleLightbox
  detailLightbox = $('.details-panel .image-grid a').simpleLightbox({
    captions: false,
    nav: true,
    close: true,
    docClose: true,
    enableKeyboard: true,
    showCounter: false
  });

  // Initialize ordering table
  VSlot.table.init();

  // Initialize Ecwid cart and waste-policy toggle
  Ecwid.init();
  $('#readMoreLink').on('click', function(e) {
    e.preventDefault();
    $('#wasteDetails').slideToggle(200);
  });
});
</script>
<script>
(function(VSlot, $) {
  // Filter module for extrusion selector
  VSlot.filters = {
    items: [],
    selectedFilters: { type: new Set(), series: new Set(), color: new Set() },
    init: function(items) {
      this.items = items;
      this.renderFilterPills();
      $('#clearFiltersBtn').on('click', () => {
        Object.values(this.selectedFilters).forEach(set => set.clear());
        $('.filter-pill').removeClass('selected');
        this.applyFilters();
      });
    },
    renderFilterPills: function() {
      const groups = [
        { field: 'type',   selector: '#typeFilters',   label: 'Type:'   },
        { field: 'series', selector: '#seriesFilters', label: 'Series:' },
        { field: 'color',  selector: '#colorFilters',  label: 'Colour:' }
      ];
      groups.forEach(g => {
        const container = $(g.selector).empty().append(`<strong>${g.label}</strong>`);
        const values = [...new Set(this.items.map(e => e.attributes[g.field]))];
        values.forEach(val => {
          const count = this.items.filter(e => e.attributes[g.field] === val).length;
          const pill = $(`<span class="filter-pill" data-field="${g.field}" data-value="${val}">${val} (${count})</span>`);
          pill.on('click', () => this.toggleFilter(g.field, val, pill));
          container.append(pill);
        });
      });
    },
    toggleFilter: function(field, value, pillEl) {
      const set = this.selectedFilters[field];
      if (set.has(value)) {
        set.delete(value);
        pillEl.removeClass('selected');
      } else {
        set.add(value);
        pillEl.addClass('selected');
      }
      this.applyFilters();
    },
    applyFilters: function() {
      const filtered = this.items.filter(e =>
        (this.selectedFilters.type.size === 0   || this.selectedFilters.type.has(e.attributes.type))   &&
        (this.selectedFilters.series.size === 0 || this.selectedFilters.series.has(e.attributes.series)) &&
        (this.selectedFilters.color.size === 0  || this.selectedFilters.color.has(e.attributes.color))
      );
      populateExtrusionBoxes(filtered);
    }
  };
})(window.VSlot = window.VSlot || {}, jQuery);
</script>
</html>